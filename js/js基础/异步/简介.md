# 异步的概念
- Javascript语言的执行环境是"单线程"，所谓"单线程"，就是指一次只能完成一件任务。如果有多个任务，就必须排队，前面一个任务完成，再执行后面一个任务，以此类推。
- 这种模式的好处是实现起来比较简单；坏处是只要有一个任务耗时很长，后面的任务都必须排队等着，会拖延整个程序的执行。
- 为了解决这个问题，Javascript语言将任务的执行模式分成两种：同步（Synchronous）和异步（Asynchronous）。
- 异步编程的代码不会阻塞后续代码的执行，不是有序执行的，对于操作一些耗时操作执行效率更高
### 什么时候使用异步
1. 事件监听函数的回调
2. 定时器函数的回调
3. 网络请求
### 实现异步编程
1. 回调函数
- 有这样一个场景，有两个函数f1,f2，f2的执行需要等待f1的结果，而f1的执行是一个耗时的操作，就可以将f2作为f1的回调函数
```js
  function f2(){}
　function f1(callback){
    // 异步执行f1,先去执行其他逻辑
    setTimeout(()=>{
　　　　　　// f1的任务代码
           // ...
           // 等到f1逻辑执行完毕后执行f2
　　　　　　callback();
    })
　}
 f1(f2);
```
- 采用这种方式，我们把同步操作变成了异步操作，f1不会堵塞程序运行，相当于先执行程序的主要逻辑，将耗时的操作推迟执行。
- 回调函数的优点是简单、容易理解，缺点是不利于代码的阅读和维护，各个部分之间高度耦合，流程会很混乱，多层的嵌套会造成“回调地狱”。
2. 事件监听
- 采用事件驱动模式。任务的执行不取决于代码的顺序，而取决于某个事件是否发生。
- 下面代码使用jquery语法
```js
   // 为f2绑定done事件，执行f2函数
　　f1.on('done', f2);
　　function f1(){
　　　　setTimeout(function () {
　　　　　　// f1的任务代码
            // 触发done事件，由于f1监听了done,则会执行f2函数
　　　　　　f1.trigger('done');
　　　　}, 1000);

　　}
```
- 这种方法的优点是比较容易理解，可以绑定多个事件，每个事件可以指定多个回调函数，有利于实现模块化
- 缺点是整个程序都要变成事件驱动型，运行流程会变得很不清晰。
3. 发布/订阅
- 我们假定，存在一个"信号中心"，某个任务执行完成，就向信号中心"发布"（publish）一个信号，其他任务可以向信号中心"订阅"（subscribe）这个信号，从而知道什么时候自己可以开始执行。这就叫做"发布/订阅模式"（publish-subscribe pattern）。
- 流程应该是先订阅，再发布
```js
  // jQuery 
　jQuery.subscribe("done", f2);
　function f1(){
　　　　setTimeout(function () {
　　　　　　// f1的任务代码
　　　　　　jQuery.publish("done");
　　　　}, 1000);
　　}
```
- 这种方法的性质与"事件监听"类似，但是明显优于后者。因为我们可以通过查看"消息中心"，了解存在多少信号、每个信号有多少订阅者，从而监控程序的运行。
4. promise
- 通过new Promise(resolve,reject){}创建一个promise实例，resolve/reject是两个函数，每个promise实例拥有then方法，then方法有两个函数参数，第一个参数是成功状态触发，第二个函数是失败状态触发，当resolve/reject函数执行会触发then函数中的回调函数的执行